controllers = angular.module('controllers')
controllers.controller("UserController", [ '$scope', '$routeParams', '$location', '$resource', '$route', '$templateCache'
  ($scope,$routeParams,$location,$resource,$route,$templateCache)->
    User = $resource('/users/:userId', { userId: "@id", format: 'json' })
    User.get({userId: $routeParams.userId},
      ((user) ->
        $scope.user = user
        $scope.songs = user.songs
      ),
      (httpResponse)-> $scope.user = null
    )

    $scope.add_this = (song_url) ->
      if(song_url.length)
        add_song = $resource('/users/:userId/add_song',
                             { userId: '@id', format: 'json' },
                             { update: { method: 'POST', params: { song_url: song_url } } }
                            )
        add_song.update({id: $routeParams.userId},
                         (response) ->
                           $route.reload()
                        )

    $scope.play_song = (songId) ->
      console.log(songId)
      $location.url("/song/#{songId}")
])
